<link rel="import" href="../polymer/polymer.html">



<script>

  GamepadBehavior = {

    properties: {
      supported: {
        type: Boolean,
        readOnly: true,
        value: function () {
          return !!navigator.getGamepads;
        }
      },

      index: {
        type: Number,
        observer: '_indexChanged'
      },

      gamepad: {
        type: Object,
        readOnly: true,
        notify: true
      }
    },

    updateGamepad: function () {
      if(this.supported){
        //to force notify of timestamp/axes/other properties
        this._setGamepad(undefined);
        this._setGamepad(navigator.getGamepads()[this.index]);
        this.afterUpdate();
      }
    },

    afterUpdate: function () {
    },

    _indexChanged: function (newIndex, oldIndex) {
      if(newIndex >= 0){
        this.updateGamepad();
      }
    },

    _setGamepad: function (gamepad) {
      this.set('gamepad', gamepad);
    },

    _onGamepadConnected: function (e) {
      this.updateGamepad();
    },

    _onGamepadDisconnected: function (e) {
      this.updateGamepad();
    },

    attached: function () {
      window.addEventListener('gamepadconnected', this._onGamepadConnected.bind(this));
      window.addEventListener('gamepaddisconnected', this._onGamepadDisconnected.bind(this));
    },

    detached: function () {
      window.removeEventListener('gamepadconnected', this._onGamepadConnected);
      window.removeEventListener('gamepaddisconnected', this._onGamepadDisconnected);
    }
  };
</script>
